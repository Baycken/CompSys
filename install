#!/bin/bash
#
# Install the McGill Robotic CompSys package

# Determine ROBOTIC_PATH
export ROBOTIC_PATH=$(dirname ${PWD})

# Ask if robot
echo "Are you a robot?"
echo "If uncertain, select NO."
select yn in "YES" "NO"; do
  case "${yn}" in
    YES )
      export IAMROBOT=true
      echo "E: ROBOT NOT YET SUPPORTED"
      exit 1
      break;;
    NO )
      export IAMROBOT=false
      break;;
  esac
done
echo

# Select project
echo "Which project are you working on?"
select project in "AUV" "ROVER"; do
  case "${project}" in
    AUV )
      export ROBOT=auv
      break;;
    ROVER )
      export ROBOT=rover
      break;;
  esac
done
echo

# Ask to install Zsh
echo "Would you like to switch from bash to Zsh?"
echo "If uncertain, select NO."
select yn in "YES" "NO"; do
  case "${yn}" in
    YES )
      echo
      ./setup/zsh/install
      break;;
    NO )
      break;;
  esac
done

# Ask to install ROS if not installed
if [[ -z ${ROS_DISTRO} ]]; then
  echo "ROS is not installed! Would you like to install it?"
  echo "This will take a while, select NO if you don't have time now."
  select ros in "YES" "NO"; do
    case "${ros}" in
      YES )
        ./setup/ros/install
        break;;
      NO )
        break;;
    esac
  done
fi

# Update and install packages
echo " * Refreshing apt package list..."
sudo apt-get -qq update
source ${ROBOTIC_PATH}/compsys/update

# Clone repository
robot_git=${ROBOTIC_PATH}/${ROBOT}
if [[ ! -d ${robot_git} ]]; then
  echo " * Cloning ${robot} git repository..."
  git clone git@github.com:mcgill-robotics/${ROBOT}.git ${robot_git}
  echo "   ...done."
  echo
fi

# Configure RC files
source ${ROBOTIC_PATH}/compsys/setup/config/install

# Setup git hook
source ${ROBOTIC_PATH}/compsys/setup/hooks/install
